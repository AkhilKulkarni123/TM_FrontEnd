<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Square 23 - Castle Builder</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
        }
        h1 {
            color: #8E2DE2;
            text-align: center;
            margin-bottom: 10px;
        }
        .instructions {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
        }
        .game-area {
            position: relative;
            width: 100%;
            height: 450px;
            background: linear-gradient(180deg, #87CEEB 0%, #90EE90 80%, #8B4513 100%);
            border-radius: 10px;
            overflow: hidden;
            border: 3px solid #4A00E0;
        }
        .block-palette {
            display: flex;
            gap: 10px;
            justify-content: center;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .block-type {
            width: 60px;
            height: 60px;
            border: 3px solid #333;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .block-type:hover {
            transform: scale(1.1);
        }
        .block-type.selected {
            border-color: #8E2DE2;
            box-shadow: 0 0 10px #8E2DE2;
        }
        .placed-block {
            position: absolute;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
        }
        .placed-block:hover {
            opacity: 0.7;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
        }
        .stat {
            background: #f0f0f0;
            padding: 10px 20px;
            border-radius: 10px;
        }
        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .reset-btn {
            background: #FF6B6B;
            color: white;
        }
        .claim-btn {
            background: #51CF66;
            color: white;
        }
        .claim-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .clear-btn {
            background: #FFD93D;
            color: #333;
        }
        .height-marker {
            position: absolute;
            right: 10px;
            top: 10px;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            color: #8E2DE2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè∞ Castle Builder Challenge üè∞</h1>
        <p class="instructions">Build a tall castle! Click blocks below, then click in the game area to place them!</p>
        
        <div class="block-palette">
            <div class="block-type selected" data-block="üß±" onclick="selectBlock('üß±')">üß±</div>
            <div class="block-type" data-block="ü™®" onclick="selectBlock('ü™®')">ü™®</div>
            <div class="block-type" data-block="ü™µ" onclick="selectBlock('ü™µ')">ü™µ</div>
            <div class="block-type" data-block="‚¨ú" onclick="selectBlock('‚¨ú')">‚¨ú</div>
        </div>
        
        <div class="stats">
            <div class="stat">Blocks: <span id="blocks">0</span>/30</div>
            <div class="stat">Height: <span id="height">0</span></div>
            <div class="stat">Bullets: <span id="bullets">0</span></div>
        </div>
        
        <div class="game-area" id="gameArea">
            <div class="height-marker">Max Height: <span id="maxHeight">0</span></div>
        </div>
        
        <div class="buttons">
            <button class="clear-btn" onclick="clearCastle()">Clear Castle</button>
            <button class="reset-btn" onclick="resetGame()">Reset Game</button>
            <button class="claim-btn" id="claimBtn" onclick="claimBullets()" disabled>Claim Bullets</button>
        </div>
    </div>

    <script>
        let blocksPlaced = 0;
        let maxHeight = 0;
        let bullets = 0;
        let selectedBlock = 'üß±';
        let placedBlocks = [];
        
        const gameArea = document.getElementById('gameArea');
        
        function selectBlock(block) {
            selectedBlock = block;
            document.querySelectorAll('.block-type').forEach(el => {
                el.classList.remove('selected');
                if (el.dataset.block === block) {
                    el.classList.add('selected');
                }
            });
        }
        
        gameArea.addEventListener('click', (e) => {
            if (blocksPlaced >= 30) {
                alert('Maximum blocks placed! Submit your castle!');
                return;
            }
            
            const rect = gameArea.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const gridX = Math.floor(x / 50) * 50;
            const gridY = Math.floor(y / 50) * 50;
            
            const existingBlock = placedBlocks.find(b => 
                b.x === gridX && b.y === gridY
            );
            
            if (existingBlock) {
                return;
            }
            
            placeBlock(gridX, gridY);
        });
        
        function placeBlock(x, y) {
            const block = document.createElement('div');
            block.className = 'placed-block';
            block.textContent = selectedBlock;
            block.style.left = x + 'px';
            block.style.top = y + 'px';
            
            block.addEventListener('click', (e) => {
                e.stopPropagation();
                removeBlock(block, x, y);
            });
            
            gameArea.appendChild(block);
            placedBlocks.push({ x, y, element: block });
            
            blocksPlaced++;
            document.getElementById('blocks').textContent = blocksPlaced;
            
            calculateHeight();
            
            if (blocksPlaced >= 30) {
                endGame();
            }
        }
        
        function removeBlock(blockElement, x, y) {
            blockElement.remove();
            placedBlocks = placedBlocks.filter(b => !(b.x === x && b.y === y));
            blocksPlaced--;
            document.getElementById('blocks').textContent = blocksPlaced;
            calculateHeight();
        }
        
        function calculateHeight() {
            if (placedBlocks.length === 0) {
                maxHeight = 0;
            } else {
                const bottomY = gameArea.offsetHeight;
                const minY = Math.min(...placedBlocks.map(b => b.y));
                maxHeight = Math.floor((bottomY - minY) / 50);
            }
            
            bullets = Math.floor(maxHeight / 2);
            
            document.getElementById('height').textContent = maxHeight;
            document.getElementById('maxHeight').textContent = maxHeight;
            document.getElementById('bullets').textContent = bullets;
        }
        
        function clearCastle() {
            placedBlocks.forEach(block => block.element.remove());
            placedBlocks = [];
            blocksPlaced = 0;
            maxHeight = 0;
            bullets = 0;
            
            document.getElementById('blocks').textContent = '0';
            document.getElementById('height').textContent = '0';
            document.getElementById('maxHeight').textContent = '0';
            document.getElementById('bullets').textContent = '0';
        }
        
        function endGame() {
            document.getElementById('claimBtn').disabled = false;
            alert(`Castle complete! You built to height ${maxHeight} and earned ${bullets} bullets!`);
        }
        
        function resetGame() {
            clearCastle();
            document.getElementById('claimBtn').disabled = true;
        }
        
        function claimBullets() {
            if (bullets === 0) {
                alert('Build a taller castle to earn bullets!');
                return;
            }
            alert(`You earned ${bullets} bullets! Returning to game...`);
            window.location.href = '/';
        }
    </script>
</body>
</html>